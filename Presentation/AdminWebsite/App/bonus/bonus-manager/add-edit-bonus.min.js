(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}},t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n},i={}.hasOwnProperty;define(["bonus/bonus-manager/bonusBase","bonus/bonusCommon","komapping","shell","nav","i18next","dateBinders"],function(i,r,u,f,e,o){return function(i){function s(){this.detached=n(this.detached,this);this.activate=n(this.activate,this);this.processResponse=n(this.processResponse,this);this.submit=n(this.submit,this);this.getBrandField=n(this.getBrandField,this);s.__super__.constructor.call(this);this.vTemplates=ko.computed(function(n){return function(){var t;return(t=f.brandValue(),t===null)?n.templates():ko.utils.arrayFilter(n.templates(),function(n){return n.brand.Id===t})}}(this));this.ActiveTo.subscribe(function(n){return function(){return n.ActiveTo.isModified(!1)}}(this));this.vLicenseeName=ko.computed(function(n){return function(){return n.getBrandField("LicenseeName")}}(this));this.vBrandName=ko.computed(function(n){return function(){return n.getBrandField("Name")}}(this));this.vRequireBonusCode=ko.computed(function(n){return function(){var t;return t=ko.utils.arrayFirst(n.templates(),function(t){return t.Id===n.TemplateId()}),t!=null?t.RequireBonusCode:void 0}}(this));this.Code.extend({required:{params:!0,message:o.t("common.requiredField"),onlyIf:this.vRequireBonusCode}})}return t(s,i),s.prototype.getBrandField=function(n){var t;return t=ko.utils.arrayFirst(this.templates(),function(n){return function(t){return t.Id===n.TemplateId()}}(this)),t!=null?t.brand[n]:this.emptyCaption()},s.prototype.submit=function(){var n;return this.isValid()?(n=JSON.parse(u.toJSON(this,{ignore:r.getIgnoredFieldNames(this)})),$.ajax({type:"POST",url:"/Bonus/createUpdate",data:postJson(n),dataType:"json"}).done(function(n){return function(t){return n.processResponse(t)}}(this))):this.errors.showAllMessages()},s.prototype.processResponse=function(n){var t;return n.Success?(this.cancel(),$(document).trigger("bonuses_changed"),t={id:n.BonusId},t[this.Id()===void 0?"created":"edited"]=!0,e.open({path:"bonus/bonus-manager/view-bonus",title:o.t("bonus.bonusManager.view"),data:t})):n.Errors.forEach(function(n){return function(t){return t.PropertyName==="Bonus"?n.serverErrors([t.ErrorMessage]):setError(n[t.PropertyName],t.ErrorMessage)}}(this))},s.prototype.activate=function(n){$(document).on("bonus_templates_changed",this.reloadTemplates);return $.get("/Bonus/GetRelatedData",{id:n!=null?n.id:void 0}).done(function(t){return function(i){return t.templates(i.templates),n!=null?(u.fromJS(i.bonus,{},t),t.TemplateId.valueHasMutated()):void 0}}(this))},s.prototype.detached=function(){return $(document).off("bonuses_changed",this.reloadTemplates)},s}(i)})}).call(this);
//# sourceMappingURL=add-edit-bonus.min.js.map
