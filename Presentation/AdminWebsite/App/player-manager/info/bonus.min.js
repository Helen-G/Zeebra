(function(){var n=function(n,t){return function(){return n.apply(t,arguments)}};define(["bonus/bonusCommon","i18next","shell","player-manager/info/bonus-descr-dialog","controls/grid"],function(t,i,r,u){return function(){function f(){this.issueBonus=n(this.issueBonus,this);this.backToList=n(this.backToList,this);this.proceed=n(this.proceed,this);this.attached=n(this.attached,this);this.shell=r;this.i18N=i;this.playerId=ko.observable();this.stages={bonusTable:0,loadingSpinner:1,issuanceUI:2};this.currentStage=ko.observable(this.stages.bonusTable);this.bonusToIssue=ko.observable();this.transactions=ko.observableArray();this.currentTransaction=ko.observable();this.errors=ko.observableArray();this.bonusIssued=ko.observable(!1)}return f.prototype.typeFormatter=function(){return t.typeFormatter(this.Type)},f.prototype.statusFormatter=function(){return i.t(i.t("playerManager.bonus.statuses."+this.Status))},f.prototype.activate=function(n){return this.playerId(n.playerId)},f.prototype.attached=function(n){var t;t=findGrid(n);$("form",n).submit(function(){return t.trigger("reload"),!1});t.on("gridLoad selectionChange",function(n){return function(t,i){if(i.id!=null)return n.bonusToIssue({id:i.id,name:i.data.Name,description:$(i.data.Description).attr("title")})}}(this));return $(n).on("click",".player-bonus-description",function(){var n;return n=$(this).attr("title"),new u(n).show()})},f.prototype.proceed=function(){return this.stages.loadingSpinner,$.get("/PlayerBonus/Transactions",{playerId:this.playerId(),bonusId:this.bonusToIssue().id}).done(function(n){return function(t){var i;return n.transactions(function(){var n,u,r;for(r=[],n=0,u=t.length;n<u;n++)i=t[n],r.push({id:i.Id,description:i.Date+" | "+i.CurrencyCode+i.Amount,bonusAmount:""+i.CurrencyCode+i.BonusAmount});return r}()),n.currentStage(n.stages.issuanceUI)}}(this))},f.prototype.backToList=function(){return this.currentTransaction(null),this.currentStage(this.stages.bonusTable),this.bonusIssued(!1)},f.prototype.issueBonus=function(){return this.currentStage(this.stages.loadingSpinner),$.ajax({type:"POST",url:"/PlayerBonus/IssueBonus",data:{playerId:this.playerId(),bonusId:this.bonusToIssue().id,transactionId:this.currentTransaction().id},dataType:"json"}).done(function(n){return function(t){return n.currentStage(n.stages.issuanceUI),t.Success?(n.currentTransaction(null),n.bonusIssued(!0)):n.errors(t.Errors)}}(this))},f}()})}).call(this);
//# sourceMappingURL=bonus.min.js.map
